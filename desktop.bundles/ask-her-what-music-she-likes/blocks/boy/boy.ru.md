# Блок boy

## Функциональность блока
Блок `boy` — это мальчик, который хочет познакомиться с девочкой. Он не решается
сделать это, поэтому его можно воодушевить, кликнув на специальную кнопку у него
на груди.

## Архитектура блока

### Элементы блока
У блока есть вложенные элементы:
 * head<br/>
 Голова мальчика.
 * body<br/>
 Тело и одежда мальчика.
 * speech-cloud<br/>
 Облако для слов мальчика. По умолчанию облако невидимое.
 * `button`<br/>
 Кнопка для воодушевления мальчика.

У блока `boy` есть модификатор `asking` с двумя возможными значениями: `process`
и `done`.

### Модификаторы блока
Модификатор `asking` описывает, в каком состоянии находится блок. Если мальчик
задаёт вопрос девочке, то это `asking : process`. Если вопрос уже задан и
получен ответ, то `asking : done`.

Каждое значение модификатора — это определенный внешний вид и/или поведение
блока.

Так, при `asking : process` у мальчика меняется цвет элемента `head`; он
постепенно заливается краской. К этому же значению модификатора относится и
процесс запроса параметров у девочки.<br/>
А при `asking : done` становится виден элемент `speech-cloud` с результатами
вопроса к девочке.

## JavaScript-реализация

### Инициализация
Блок инициализируется, и его js-объект появляется в памяти браузера, только
после того как пользователь кликнет левой кнопкой мыши на элементе
`button`.<br/>
Такая отложенная инициализация возможна благодаря статическому методу `live`
блока. Там вызывается метод `liveInitOnEvent`, в результате которого слушается
событие `leftclick` на элементе `button`. Когда это событие происходит, блок
`boy` приобретает модификатор `js` в значении `inited`.

### Установка модификаторов и их поведение
Фреймворк `i-bem` позволяет описывать поведение БЭМ-блока на языке состояний
(модификаторов). То, какие действия нужно выполнять при установке того или иного
модификатора, описывается в секции `onSetMod`.

Как только блок инициализируется, он приобретает модификатор `js`. Поведение
этого модификатора несложное, он сразу запускает процесс общения с девочкой,
назначая блоку модификатор `asking : process`.

Модфикатор `asking` в значении `process` вызывает метод блока `askGirl` и
записывает результат в элемент `speech-cloud`. Затем блок переводится в
следующее состояние при помощи установки модификатора `asking` в значение
`done`. Эти действия отложены на 2 секунды, чтобы дать мальчику время.

### Методы блока
Кроме описанных модификаторов, у блока могут быть любые произвольные методы. В
данном случае такой метод только один, это `askGirl`.

###Поиск другого блока через общий контейнер
В методе `askGirl` есть обращение к блоку `girl` и считывание параметров
напрямую из объекта блока. Это возможно, потому что при нахождении блока сразу
происходит его инициализация.

Здесь блок ищется через общий контейнер. Известно, что и мальчик `boy`, и
девочка `girl` находятся внутри блока `world`. Поэтому можно сначала найти блок
`world` при помощи хелпера `findBlockOutside`. Результатом этого поиска будет
экземпляр блока `world`, у которого в свою очередь тоже есть `find*` методы.
Поэтому, используя `findBlockInside` можно найти блок `girl` внутри `world` и
напрямую обратиться к её параметрам через свойство `params`.

## Зависимости
Возможность реагировать на клик только левой (не правой) кнопкой мыши есть при
применении специального плагина для jQuery. Этот плагин хранится в библиотеке
bem-bl как элемент `leftclick` блока `i-jquery'.

Для гарантированного подключения кода элемента при наличии блока `boy` на
странице используется описание зависимостей блока в формате `deps.js`:

    shouldDeps: [
        {
            block: 'i-jquery',
            elem: 'leftclick'
        }
    ]

<!-- Yandex.Metrika counter -->
<img src="//mc.yandex.ru/watch/20590624" style="position:absolute;left:-9999px;" alt="" />
<!-- /Yandex.Metrika counter -->
